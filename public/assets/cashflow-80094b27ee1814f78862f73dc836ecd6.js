function parseUserInputTable(t,e,a){financialControlError=!1,dateHeaders=$(".cf-date-selector"),cashFlowDateRange=[],$.each(dateHeaders,function(t,e){var a=$(e).data("date");cashFlowDateRange.push(a)}),monthsPerCashFlowServerSide=$("#cf-control-selector").data("months"),monthsPerCashFlowServerSide!=cashFlowDateRange.length&&(financialControlError=!0,console.log("error set"));{var l=[];$(t).each(function(){profitBeesTag=$(this).data("pb-tag"),transactionType=$(this).data("pb-type"),$rowOfCells=$(this).find("td"),rowData={},rowData.monea_tag=profitBeesTag,rowData.type=transactionType,$rowOfCells.each(function(t){amountInput=$(this).find("input").val(),0==t?rowData.mi_tag=amountInput:rowData[cashFlowDateRange[t-1]]=amountInput}),l.push(rowData)})}l.pop(),setLocalStorage(e,l),persistData={vat:a,transactions:JSON.parse(localStorage.getItem(e))},$.ajax({url:"/cash_flow_ledgers/"+$("#cashflow_id").val()+"/add_transactions",data:persistData,method:"POST",dataType:"SCRIPT"})}function updateView(t,e,a){cellWithTotal=t.cells[a],targetCell=e.find("td")[a].children[0],targetCell.value=cellWithTotal.children[0].value,cashFlowHelper.updateRowTotalWith($(targetCell))}function strToNumber(t){return parseInt(t)||0}function setLocalStorage(t,e){localStorage[t]=JSON.stringify(e)}$(document).on("page:load ready",function(){uiSharedHelper.setAccordianHandlers(),$(".user-input-amt").change(function(){cashFlowHelper.updateRowTotalWith($(this)),cashFlowHelper.updateSummaryTableColumnTotal($(this)),cashFlowHelper.updateSumofSummariesTable($(this))}),$("#save-rev-inc-vat").on("click",function(){cashFlowHelper.cacheRevenueWithVatData()}),$("#save-rev-exc-vat").on("click",function(){cashFlowHelper.cacheRevenueNoVatData()}),$("#save-cos-inc-vat").on("click",function(){cashFlowHelper.cacheCostsOfSaleWithVatData()}),$("#save-cos-exc-vat").on("click",function(){cashFlowHelper.cacheCostsOfSaleNoVatData()})});var cashFlowHelper=function(){return{cacheRevenueNoVatData:function(){vatData=!1,tableIdSelector="tbody#revenue-exc-vat tr",localStorageKey="revenue-exc-vat",parseUserInputTable(tableIdSelector,localStorageKey,vatData)},cacheRevenueWithVatData:function(){vatData=!0,tableIdSelector="tbody#revenue-inc-vat tr",localStorageKey="revenue-inc-vat",parseUserInputTable(tableIdSelector,localStorageKey,vatData)},cacheCostsOfSaleWithVatData:function(){vatData=!0,tableIdSelector="tbody#cos-inc-vat tr",localStorageKey="cos-inc-vat",parseUserInputTable(tableIdSelector,localStorageKey,vatData)},cacheCostsOfSaleNoVatData:function(){tableIdSelector="tbody#cos-exc-vat tr",localStorageKey="cos-exc-vat",parseUserInputTable(tableIdSelector,localStorageKey)},updateRowTotalWith:function(t){if(miTag=t.parent().parent().find("input")[0].value,""==miTag)alert("Add Mi Tag first"),t.val("");else{inputCell=t,inputRow=inputCell.parent().parent(),inputRowTotalCell=inputRow.find("td:last"),$rowOfCells=$(inputRow).find("td"),rowData=[],$rowOfCells.each(function(){amountInput=$(this).find("input").val(),rowData.push(amountInput)}),cleansedData=rowData.slice(1,rowData.length-1),console.log(cleansedData);var e=cleansedData.reduce(function(t,e){return strToNumber(t)+strToNumber(e)});inputRowTotalCell[0].innerText=e,console.log(e)}},updateSummaryTableColumnTotal:function(t){var e=0;parentSection=t.parent().parent().closest("section"),totalSection=parentSection.next("section").find("table");var a=parentSection.find("tbody");inputCellIndex=t.parent().index();var l=totalSection.find("tr");for(j=0;j<a.length;j++){var o,n=a[j].rows,r=n.length;for(o=0;r-1>o;o++){var c=n[o],i=c.cells[inputCellIndex],s=i.children[0].value,u=parseFloat(s);isNaN(u)||(e+=u,totalColumnTd=l[1].cells[inputCellIndex],totalColumnTd.children[0].value=e)}cashFlowHelper.updateRowTotalWith($(totalColumnTd.children[0]))}},updateSumofSummariesTable:function(t){inputCellIndex=t.parent().index(),totalNetDiff=$("#bottom-net-diff-summary-table"),revenueTotalTable=$("#cash-in-totals-summary-table").find("tr")[1],totalCashIn=$("#bottom-rev-summary-table"),updateView(revenueTotalTable,totalCashIn,inputCellIndex),cosTotalTable=$("#cos-out-totals-summary-table").find("tr")[1],totalCashOut=$("#bottom-out-summary-table"),updateView(cosTotalTable,totalCashOut,inputCellIndex),inSum=totalCashIn.find("td")[inputCellIndex].children[0].value,outSum=totalCashOut.find("td")[inputCellIndex].children[0].value,netDifference=parseInt(inSum)+parseInt(-1*outSum),targetCell=totalNetDiff.find("td")[inputCellIndex].children[0],targetCell.value=netDifference,cashFlowHelper.updateRowTotalWith($(targetCell))}}}();