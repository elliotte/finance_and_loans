function successDashExport(){$("#modal-report-dash-empty").trigger("click"),response=this.responseText,response.indexOf("ERROR")>-1?html='<article class="type-system-rounded"><p>ERROR</p><a href="/" data-no-turbolinks=true>RECONNECT</a></article>':(link='<a href="'+response+'" target="_blank">VIEW</a>',html='<article class="type-system-rounded"><p>Successful Export: '+link+"</p></article>"),$("#empty-report-modal-body").html(html)}function showReportShareModal(){$("#empty-modal-table").empty(),$("#table-title").empty(),$("#modal-table-empty").trigger("click"),friends=JSON.parse(localStorage.getItem("friends")).items,link='<a href="javascript:void(0)" onclick="shareReport(this)" style="text-decoration:none;color:#94CFD5;">Share</a>',$("#empty-modal-table").append('<p style="color:#F3655E;font-size:80%;">You can search your friends list using the browser CTRL + F feature</p>'),$.each(friends,function(e,t){imgSrc=t.image.url,html='<tr id="'+t.id+'"><td><img src="'+imgSrc+'" ></td><td>'+t.displayName+"</td><td>"+link+"</td></tr>",$("#empty-modal-table").append(html)})}function shareReport(e){function t(){$("#table-title").empty(),$("#empty-modal-table").empty(),response=this.responseText,html=response.indexOf("ERROR")>-1?'<p>ERROR</p><a href="/" data-no-turbolinks=true>RECONNECT</a>':"<td>Successfully shared Ledger with: "+response+"</td>",$("#empty-modal-table").append(html)}shareUserID=e.parentNode.parentNode.getAttribute("id");var a=$("meta[name='csrf-token']").attr("content");reportId=$("#report-id").val();var s=new XMLHttpRequest;s.onload=t,data={userID:shareUserID},route="/reports/"+reportId+"/share",console.log(route),s.open("put",route,!0),s.setRequestHeader("Content-Type","application/json"),s.setRequestHeader("X-CSRF-Token",a),s.send(JSON.stringify(data))}function cacheNotes(e){$.ajax({url:"/reports/"+e+"/get_notes",dataType:"JSON",type:"GET",success:function(e){localStorage.setItem("notes",JSON.stringify(e)),showNotes()}})}function cacheComments(e){$.ajax({url:"/reports/"+e+"/get_comments",dataType:"JSON",type:"GET",success:function(e){localStorage.setItem("comments",JSON.stringify(e)),showComments()}})}function showComments(){source=$("#comment-template").html(),templ=Handlebars.compile(source),comments=JSON.parse(localStorage.getItem("comments"));var e=templ(comments);$(".comments_data").html(e)}function showNotes(){source=$("#note-template").html(),templ=Handlebars.compile(source),notes=JSON.parse(localStorage.getItem("notes"));var e=templ(notes);$(".notes_data").html(e)}function showDashNotes(e){notes=JSON.parse(localStorage.getItem("notes"));var t=[];$.each(notes,function(a,s){s.subject==e&&t.push(notes[a])}),source=$("#note-template").html(),templ=Handlebars.compile(source);var a=templ(t);$(".notes_data").html(a),$("#report-notes-modal").trigger("click")}function showDashComments(e){comments=JSON.parse(localStorage.getItem("comments"));var t=[];$.each(comments,function(a,s){s.subject==e&&t.push(comments[a])}),source=$("#comment-template").html(),templ=Handlebars.compile(source);var a=templ(t);$(".comments_data").html(a),$("#report-comments-modal").trigger("click")}var reportHelper=function(){var e=2;return{filterBy:function(e){function t(e){$.each(all_values,function(t,a){valueID=$(a).data("value-id"),rowHandler="tr#"+valueID,valueProp=$(a).data(e),valueProp==filterVariable?$(rowHandler).show():$(rowHandler).hide()})}switch(filterVariable=e.value,filterFormat=$(e).attr("id"),all_values=$(".trn-report-mgr"),filterFormat){case"v_type":t("type");break;case"v_month":t("month");break;case"ifrstag":t("ifrstag")}},loadValuesByMiTag:function(e,t,a){lineDescription=$(e).data("mitag"),allValues=$("."+t+"_"+lineDescription);var s=a;allValues=$.grep(allValues,function(e){return a=$(e).data("period"),a==s}),reportHelper.appendModalShowPageValues(allValues)},loadValuesByDescription:function(e,t){lineDescription=$(e).data("description"),allValues=$(".value-lookup");var a=t;showValues=$.grep(allValues,function(e){return t=$(e).data("period"),jsDesc=$(e).data("desc"),t==a&&jsDesc==lineDescription}),reportHelper.appendModalShowPageValues(showValues)},loadJournalValues:function(e,t){lineDescription=$(e).data("description"),allValues=$('[class^="etb"]');var a=t;showValues=$.grep(allValues,function(e){return t=$(e).data("period"),jsDesc=$(e).data("desc"),t==a&&jsDesc==lineDescription}),reportHelper.appendModalShowPageValues(showValues)},appendModalShowPageValues:function(e){function t(e){e+="";for(var t=e.split("."),a=t[0],s=t.length>1?"."+t[1]:"",o=/(\d+)(\d{3})/;o.test(a);)a=a.replace(o,"$1,$2");return a+s}body=$("#empty-modal-table"),title=$("#table-title"),body.empty(),title.empty(),$("#modal-table-empty").trigger("click"),header='<tr style="color:#f3655e;"><td>Type</td><td>Date</td><td>miTag</td><td>\xa3</td><td>moneaTag</td></tr>',body.append(header),$.each(e,function(e,a){amt=t($(a).data("amount")),html="<tr><td>"+$(a).data("type")+"</td><td>"+$(a).data("date")+"</td><td>"+$(a).data("mitag")+"</td><td>"+amt+"</td><td>"+$(a).data("ifrstag")+"</td></tr>",body.append(html)}),title.append('<p style="color:#f3655e;"> Summary: '+lineDescription+"</p>")},loadShowPageData:function(){var e={cp:"",pp:""};return all_cy_RepLines=$(".cy-graph-rep-lines"),data=[["yourTag","Amount"]],$.each(all_cy_RepLines,function(e,t){tag=$(t).data("key"),amt=$(t).data("amount"),"undefined"!=typeof tag&&"undefined"!=typeof amt&&data.push([tag,amt])}),e.cp=data,all_pp_RepLines=$(".pp-graph-rep-lines"),data=[["yourTag","Amount"]],$.each(all_pp_RepLines,function(e,t){tag=$(t).data("key"),amt=$(t).data("amount"),"undefined"!=typeof tag&&"undefined"!=typeof amt&&data.push([tag,amt])}),e.pp=data,console.log(e),e},addValueToJournalForm:function(){if(e>30)alert("Only 30 Values allowed");else{var t=$(".value_template tbody").html();t=t.replace(/index/g,e),$(".etb_values tbody").append(t),e++}}}}(),ifrsDashShow=function(){return{cacheData:function(){var e={cy:{gp_rev:[],gp_cos:[],op_rev:[],op_cos:[],tax:[],assets:[],liabs:[]},py:{gp_rev:[],gp_cos:[],op_rev:[],op_cos:[],tax:[],assets:[],liabs:[]}},t=$(".js-fs-line");return $.each(t,function(t,a){switch(tag=$(a).data("tag"),lineDescription=$(a).data("reporting-line"),cy_amt=$(a).data("cy"),py_amt=$(a).data("py"),cy_info=[lineDescription,cy_amt],py_info=[lineDescription,py_amt],tag){case"gp-rev":e.cy.gp_rev.push(cy_info),e.py.gp_rev.push(py_info);break;case"gp-cos":e.cy.gp_cos.push(cy_info),e.py.gp_cos.push(py_info);break;case"op-rev":e.cy.op_rev.push(cy_info),e.py.op_rev.push(py_info);break;case"op-cos":e.cy.op_cos.push(cy_info),e.py.op_cos.push(py_info);break;case"pbt-cos":e.cy.tax.push(cy_info),e.py.tax.push(py_info);break;case"tax":e.cy.tax.push(cy_info),e.py.tax.push(py_info);break;case"fa_tang":e.cy.assets.push(cy_info),e.py.assets.push(py_info);break;case"fa_intang":e.cy.assets.push(cy_info),e.py.assets.push(py_info);break;case"curr_assets":e.cy.assets.push(cy_info),e.py.assets.push(py_info);break;case"ca":e.cy.assets.push(cy_info),e.py.assets.push(py_info);break;case"nca":e.cy.assets.push(cy_info),e.py.assets.push(py_info);break;case"assets":e.cy.assets.push(cy_info),e.py.assets.push(py_info);break;case"cred_current":e.cy.liabs.push(cy_info),e.py.liabs.push(py_info);break;case"cred_greater":e.cy.liabs.push(cy_info),e.py.liabs.push(py_info);break;case"capital":e.cy.liabs.push(cy_info),e.py.liabs.push(py_info);break;case"ncl":e.cy.liabs.push(cy_info),e.py.liabs.push(py_info);break;case"cl":e.cy.liabs.push(cy_info),e.py.liabs.push(py_info);break;case"liabs":e.cy.liabs.push(cy_info),e.py.liabs.push(py_info)}}),e},loadStats:function(){gpData=[$("#js-gp-margin-data"),$("#js-op-margin-data"),$("#js-margin-data")],cy_statsViewList=$("#cy-p-n-l-stats"),py_statsViewList=$("#py-p-n-l-stats"),$.each(gpData,function(e,t){switch(statText=$(t).attr("id"),displayText="",statText){case"js-gp-margin-data":displayText="GP Margin";break;case"js-op-margin-data":displayText="OP Margin";break;case"js-margin-data":displayText="Profit Margin"}cy_html="<li>"+$(t).data("cy")+"<span>"+displayText+"</span></li>",py_html="<li>"+$(t).data("py")+"<span>"+displayText+"</span></li>",$(cy_statsViewList).append(cy_html),$(py_statsViewList).append(py_html)})},loadData:function(){var e=this.cacheData();return e},exportDashGoogle:function(){var e=$(".js-fs-line"),t=[];$.each(e,function(e,a){tag=$(a).data("tag"),lineDescription=$(a).data("reporting-line"),cy_amt=$(a).data("cy"),py_amt=$(a).data("py"),row=[lineDescription,cy_amt,py_amt,tag],t.push(row)});var a=$("meta[name='csrf-token']").attr("content"),s=new XMLHttpRequest;s.onload=successDashExport,s.open("post","/reports/"+$("#report-id").val()+"/export_dash",!0),s.setRequestHeader("Content-Type","application/json"),s.setRequestHeader("X-CSRF-Token",a),s.send(JSON.stringify(t))}}}();