
function successDashExport() {
    $('#modal-report-dash-empty').trigger('click');
    response = this.responseText
    if (response.indexOf("ERROR") > -1) {
      html = '<article class="type-system-rounded">' + '<p>' + 'ERROR' + '</p>' +
             '<a href="/" data-no-turbolinks=true>' + 'RECONNECT' + '</a>' + '</article>'
    } else {
      link = '<a href="'+response+'" target="_blank">' + 'VIEW' + '</a>'
      html = '<article class="type-system-rounded">' + '<p>' + 'Successful Export: ' + link + '</p>' + '</article>'
    }
    $('#empty-report-modal-body').html(html)
};

function showReportShareModal(){
  $('#bg-screen-for-modal').addClass('open')
  
  link = '<a href="javascript:void(0)" onclick="shareReport(this)" style="text-decoration:none;color:#94CFD5;">' + 'Share' + '</a>'
  $('#bg-screen-for-modal').find('section').empty().append('<p style="color:#F3655E;font-size:80%;">' + 'You can search your friends list using the browser CTRL + F feature' + '</p>')

  friends = JSON.parse(localStorage.getItem("friends")).items
  $.each(friends, function(index, person) {
    imgSrc = person.image.url
    html = '<tr id="' + person.id + '">' +
        '<td>' + '<img src="' + imgSrc + '" >' + '</td>' +
        '<td>' + person.displayName + '</td>' +
        '<td>' + link + '</td>' +
    '</tr>'
    $('#bg-screen-for-modal').find('section').append(html);

  });
}

function shareReport(obj){
  shareUserID = obj.parentNode.parentNode.getAttribute('id');

  var token = $("meta[name='csrf-token']").attr("content");
  reportId = $('#report-id').val();

  var request = new XMLHttpRequest();
  request.onload = shareSuccess;
  //request.onerror = errorDisplay;
  data = {
    userID: shareUserID,
  }
  route = '/reports/' + reportId + '/share'
  console.log(route)
  request.open("put", route, true );
  request.setRequestHeader("Content-Type", "application/json");
  request.setRequestHeader("X-CSRF-Token", token);
  request.send(JSON.stringify(data));
  
  function shareSuccess() {
    
      $('#table-title').empty();
      $('#empty-modal-table').empty();

      response = this.responseText
      if (response.indexOf("ERROR") > -1) {
        html = '<p>' + 'ERROR' + '</p>' +
             '<a href="/" data-no-turbolinks=true>' + 'RECONNECT' + '</a>'
      } else {
        html = '<td>' + 'Successfully shared Ledger with: ' + response + '</td>'
      }
      $('#empty-modal-table').append(html) 
  };
  // END OF SHARE SUCCESS
}

function showDashNotes(type){
  notes = JSON.parse(localStorage.getItem('notes'));
  var relevant_notes = []
  $.each(notes, function(i, v){
    if(v.subject == type){
      relevant_notes.push(notes[i])
    }
  })
  source = $('#note-template').html();
  templ = Handlebars.compile(source)
  var notes_html = templ(relevant_notes)
  $('.notes_data').html(notes_html);
  $("#report-notes-modal").trigger("click")
}

function showDashComments(type){
  comments = JSON.parse(localStorage.getItem('comments'));
  var relevant_comments = []
  $.each(comments, function(i, v){
    if(v.subject == type){
      relevant_comments.push(comments[i])
    }
  })
  source = $('#comment-template').html();
  templ = Handlebars.compile(source)
  var comment_html = templ(relevant_comments)
  $('.comments_data').html(comment_html);
  $("#report-comments-modal").trigger("click")
}

var appendPieGraph= function() {
  data = reportHelper.loadShowPageData()
  graphHelper.drawReportShowCharts(data);
}

var appendBarGraph= function() {
  var dashData = ifrsDashShow.loadData();
  // LOAD MARGIN STATISTICS
  ifrsDashShow.loadStats();
  format = $('#dash-report-format').data('value')
  subtitleText = 'Using '+ format +' classifications';
  try {
           var CY = dashData.cy.assets
           var CY = dashData.cy.assets
           var PY = dashData.py.assets
           graphHelper.drawBSAssetChart(CY,PY, "Company assets", document.getElementById("assets-graph") );
      } catch (e) {
        console.log(e); // pass exception object to error handler
      }
} 
