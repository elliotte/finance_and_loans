<% cp = @report.current_end.strftime("%B %Y") %>
<% pp = @report.comparative_end.strftime("%B %Y") %>

<!-- CALC PLACEHOLDERS -->
<% nca_amounts = { cy: [0], py: [0] } %>
<% ca_amounts = { cy: [0], py: [0] } %>

<!-- ASSETS GRAPHS AND STATS -->

                      <% $cy_fa_tang = 0 %>
                      <% $py_fa_tang = 0 %>
                      <% @tags[:fa_tang].each do | master_tag | %>
                          <% cy = find_data(master_tag, :cy)  %>
                          <% py = find_data(master_tag, :py)  %>
                          <% cy_amt = yield_amount { cy }.to_i %>
                          <% py_amt = yield_amount { py }.to_i %>
                          <% unless (cy_amt + py_amt == 0.00) %>
                              <% $cy_fa_tang += cy_amt %>
                              <% $py_fa_tang += py_amt %>
                              <!-- HIDDEN JS LINE ASSETS -->
                              <span class="js-fs-line" data-tag="fa_tang" data-reporting-line="<%= master_tag %>" data-cy="<%= cy_amt %>" data-py="<%= py_amt %>"></span>
                          <% end %>
                          <!-- END OF UNLESS -->
                      <% end %>
                      <!-- DISPLAY SUMMARIES FA TANG -->

                      <!-- NON CURRENT ASSET TAGS -->
                      <!-- !!!!!!!! SUMMARY ITERATION !!!!!!!!! -->
                      <!-- SUM INTANGIBLE ASSET TAGS -->
                      <% $cy_fa_intang = 0 %>
                      <% $py_fa_intang = 0 %>
                      <% @tags[:fa_intang].each do | master_tag | %>
                          <% cy = find_data(master_tag, :cy)  %>
                          <% py = find_data(master_tag, :py)  %>
                          <% cy_amt = yield_amount { cy }.to_i %>
                          <% py_amt = yield_amount { py }.to_i %>
                          <% unless (cy_amt + py_amt == 0.00) %>
                              <% $cy_fa_intang += cy_amt %>
                              <% $py_fa_intang += py_amt %>
                              <!-- HIDDEN JS LINE ASSETS -->
                              <span class="js-fs-line" data-tag="fa_intang" data-reporting-line="<%= master_tag %>" data-cy="<%= cy_amt %>" data-py="<%= py_amt %>"></span>
                          <% end %>
                          <!-- END OF UNLESS -->
                      <% end %>
                      <!-- DISPLAY SUMMARIES FA TANG -->
                      
                          <% nca_amounts[:cy] << $cy_fa_intang %>
                          <% nca_amounts[:py] << $py_fa_intang %>
                          <% mvmt = $cy_fa_intang - $py_fa_intang %>
                          
                      <!-- NON CURRENT ASSET TAGS -->
                      <!-- !!!!!!!! SUMMARY ITERATION !!!!!!!!! -->
                      <!-- SUM INTANGIBLE ASSET TAGS -->
                      <% $cy_fa_intang = 0 %>
                      <% $py_fa_intang = 0 %>
                      <% @tags[:fa_invest].each do | master_tag | %>
                          <% cy = find_data(master_tag, :cy)  %>
                          <% py = find_data(master_tag, :py)  %>
                          <% cy_amt = yield_amount { cy }.to_i %>
                          <% py_amt = yield_amount { py }.to_i %>
                          <% unless (cy_amt + py_amt == 0.00) %>
                              <% $cy_fa_intang += cy_amt %>
                              <% $py_fa_intang += py_amt %>
                              <!-- HIDDEN JS LINE ASSETS -->
                              <span class="js-fs-line" data-tag="fa_invest" data-reporting-line="<%= master_tag %>" data-cy="<%= cy_amt %>" data-py="<%= py_amt %>"></span>
                          <% end %>
                          <!-- END OF UNLESS -->
                      <% end %>
                      <!-- DISPLAY SUMMARIES FA TANG -->
                      
                          <% nca_amounts[:cy] << $cy_fa_intang %>
                          <% nca_amounts[:py] << $py_fa_intang %>
                          <% mvmt = $cy_fa_intang - $py_fa_intang %>
                          
                      <!-- DISPLAY TOTAL NCA ASSETS ROW -->
                      <% cy_nca = nca_amounts[:cy].inject(:+) %>
                      <% py_nca = nca_amounts[:py].inject(:+) %>
                      <% mvmt = cy_nca - py_nca %>
                      
                      <!-- GROSS PROFIT REVENUE TAGS -->
                      <% @tags[:curr_assets].each do | master_tag | %>
                        <% cy = find_data(master_tag, :cy)  %>
                        <% py = find_data(master_tag, :py)  %>
                        <% cy_amt = yield_amount { cy }.to_i %>
                        <% py_amt = yield_amount { py }.to_i %>
                        <% unless (cy_amt + py_amt == 0.00) %>
                        
                          <% ca_amounts[:cy] << cy_amt %>
                          <% ca_amounts[:py] << py_amt %>
                          <% mvmt = cy_amt - py_amt %>
                          
                        <!-- HIDDEN JS LINE GP_COS for FSEXPORT -->
                        <span class="js-fs-line" data-tag="curr_assets" data-reporting-line="<%= master_tag %>" data-cy="<%= cy_amt %>" data-py="<%= py_amt %>"></span>
                        <% end %>
                        <!-- END OF UNLESS -->
                      <% end %>


                      <!-- DISPLAY TOTAL CURRENT ASSETS ROW -->
                      <% cy_ca = ca_amounts[:cy].inject(:+) %>
                      <% py_ca = ca_amounts[:py].inject(:+) %>
                      <% mvmt = cy_ca - py_ca %>
                      
                      <!--CREDITORS CURRENT ATAGS -->
                      <!-- !!!!!!!! SUMMARY ITERATION !!!!!!!!! -->
                      <!-- SUM ASSET TAGS -->
                      <% $cy_cred_curr = 0 %>
                      <% $py_cred_curr = 0 %>
                      <% @tags[:cred_current].each do | master_tag | %>
                          <% cy = find_data(master_tag, :cy)  %>
                          <% py = find_data(master_tag, :py)  %>
                          <% cy_amt = yield_amount { cy }.to_i %>
                          <% py_amt = yield_amount { py }.to_i %>
                          <% unless (cy_amt + py_amt == 0.00) %>
                              <% $cy_cred_curr += cy_amt %>
                              <% $py_cred_curr += py_amt %>
                              <!-- HIDDEN JS LINE ASSETS -->
                              <span class="js-fs-line" data-tag="cred_current" data-reporting-line="<%= master_tag %>" data-cy="<%= cy_amt %>" data-py="<%= py_amt %>"></span>
                          <% end %>
                          <!-- END OF UNLESS -->
                      <% end %>
